{"version":3,"file":"saveseen.min.js","sources":["../src/saveseen.js"],"sourcesContent":["\nexport const SELECTORS = {CHECKBOXES: 'table#slotmanager form.studentselectform input.studentselect'};\nexport const MOD = {};\n\n/**\n * Save the \"seen\" status.\n *\n * @param {Number} cmid the coursemodule id\n * @param {Number} appid the id of the relevant appointment\n * @param {Boolean} newseen\n * @param {Object} spinner The spinner icon shown while saving\n */\nexport const save_status = (cmid, appid, newseen, spinner, ) => {\n    const url = M.cfg.wwwroot + '/mod/scheduler/ajax.php';\n    // The request paramaters.\n    const params = 'action=saveseen&id='+cmid+'&appointmentid='+appid+'&seen='+newseen+'&sesskey='+M.cfg.sesskey;\n    const xhr = new XMLHttpRequest();\n\n    // 5 seconds of timeout.\n    xhr.timeout = 5000;\n\n    xhr.onloadstart = () => {\n        spinner.style.visibility = 'visible';\n    };\n\n    xhr.onload = () => {\n        if (xhr.status >= 200 && xhr.status < 300) {\n            setTimeout(() => {\n                spinner.style.visibility = 'hidden';\n                const parent = spinner.parentNode;\n                parent.removeChild(spinner);\n\n            }, 250);\n        } else {\n            const msg = {\n                name: xhr.status + ' ' + xhr.statusText,\n                message: xhr.responseText\n            };\n            spinner.style.visibility = 'hidden';\n            const parent = spinner.parentNode;\n            parent.removeChild(spinner);\n            throw new Error(JSON.stringify(msg));\n        }\n    };\n\n    xhr.onerror = () => {\n        spinner.style.visibility = 'hidden';\n        const parent = spinner.parentNode;\n        parent.removeChild(spinner);\n        throw new Error('Network request failed');\n    };\n\n    xhr.open('POST', url, true);\n    xhr.setRequestHeader('Content-type', 'application/x-www-form-urlencoded');\n    xhr.send(params);\n};\n\nexport const init = (cmid) => {\n    document.querySelectorAll(SELECTORS.CHECKBOXES).forEach(function(box) {\n        box.addEventListener('change', function() {\n            var div = document.createElement('div');\n            var span = document.createElement('span');\n            div.classList.add('spinner-border', 'spinner-border-sm');\n            span.classList.add('sr-only');\n            div.appendChild(span);\n            box.closest('div').appendChild(div);\n            save_status(cmid, box.value, box.checked, div);\n        });\n    });\n};\n"],"names":["SELECTORS","CHECKBOXES","save_status","cmid","appid","newseen","spinner","url","M","cfg","wwwroot","params","sesskey","xhr","XMLHttpRequest","timeout","onloadstart","style","visibility","onload","status","msg","name","statusText","message","responseText","parentNode","removeChild","Error","JSON","stringify","setTimeout","onerror","open","setRequestHeader","send","document","querySelectorAll","forEach","box","addEventListener","div","createElement","span","classList","add","appendChild","closest","value","checked"],"mappings":"wMACaA,UAAY,CAACC,WAAY,0GACnB,SAUNC,YAAc,CAACC,KAAMC,MAAOC,QAASC,iBACxCC,IAAMC,EAAEC,IAAIC,QAAU,0BAEtBC,OAAS,sBAAsBR,KAAK,kBAAkBC,MAAM,SAASC,QAAQ,YAAYG,EAAEC,IAAIG,QAC/FC,IAAM,IAAIC,eAGhBD,IAAIE,QAAU,IAEdF,IAAIG,YAAc,KACdV,QAAQW,MAAMC,WAAa,WAG/BL,IAAIM,OAAS,UACLN,IAAIO,QAAU,KAAOP,IAAIO,OAAS,KAO/B,OACGC,IAAM,CACRC,KAAMT,IAAIO,OAAS,IAAMP,IAAIU,WAC7BC,QAASX,IAAIY,cAEjBnB,QAAQW,MAAMC,WAAa,eACZZ,QAAQoB,WAChBC,YAAYrB,SACb,IAAIsB,MAAMC,KAAKC,UAAUT,MAd/BU,YAAW,KACPzB,QAAQW,MAAMC,WAAa,SACZZ,QAAQoB,WAChBC,YAAYrB,WAEpB,MAaXO,IAAImB,QAAU,KACV1B,QAAQW,MAAMC,WAAa,eACZZ,QAAQoB,WAChBC,YAAYrB,SACb,IAAIsB,MAAM,2BAGpBf,IAAIoB,KAAK,OAAQ1B,KAAK,GACtBM,IAAIqB,iBAAiB,eAAgB,qCACrCrB,IAAIsB,KAAKxB,wDAGQR,OACjBiC,SAASC,iBAAiBrC,UAAUC,YAAYqC,SAAQ,SAASC,KAC7DA,IAAIC,iBAAiB,UAAU,eACvBC,IAAML,SAASM,cAAc,OAC7BC,KAAOP,SAASM,cAAc,QAClCD,IAAIG,UAAUC,IAAI,iBAAkB,qBACpCF,KAAKC,UAAUC,IAAI,WACnBJ,IAAIK,YAAYH,MAChBJ,IAAIQ,QAAQ,OAAOD,YAAYL,KAC/BvC,YAAYC,KAAMoC,IAAIS,MAAOT,IAAIU,QAASR"}